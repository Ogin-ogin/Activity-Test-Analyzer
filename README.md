# ベンゼン酸化活性試験 自動解析システム

FT-IR測定によるベンゼン酸化活性試験のデータを自動解析するStreamlitアプリケーションです。

## 機能

- **データ自動読み込み**: FT-IRのASCIIファイル（.asc）から自動的にデータを読み込み
- **温度ステップ検出**: 設定したプロトコルに基づいて各温度ステップを自動検出
- **転換率計算**: 強度データから転換率を自動計算
- **シグモイドフィッティング**: 4パラメータシグモイド関数によるフィッティング
- **TX値計算**: T20, T50, T80などの温度を自動計算
- **グラフ生成**: 活性曲線と時系列データのグラフを自動生成
- **カスタマイズ可能なプロトコル**: 温度ステップ、時間、ランプ時間を自由に設定
- **設定の保存/読み込み**: プロトコル設定をファイルとして保存・共有可能
- **高品質グラフ保存**: 600 DPIのPNG形式で保存可能
- **日本語/英語対応**: UIの言語切り替え可能

## 必要要件

- Python 3.8以上
- Windows/Mac/Linux対応

## インストール方法

### 1. Pythonのインストール

まだPythonがインストールされていない場合は、[Python公式サイト](https://www.python.org/downloads/)から最新版をダウンロードしてインストールしてください。

### 2. 必要なパッケージのインストール

zipファイルを解凍したフォルダで、コマンドプロンプト（またはターミナル）を開き、以下のコマンドを実行してください：

```bash
pip install -r requirements.txt
```

## 使い方

### 起動方法

#### Windows
`起動.bat` をダブルクリックして起動します。

#### Mac/Linux
ターミナルで以下のコマンドを実行します：
```bash
streamlit run app.py
```

起動すると、ブラウザが自動的に開きます。開かない場合は、コマンドプロンプトに表示されるURL（例: http://localhost:8501）をブラウザで開いてください。

### 基本的な使い方

1. **プロトコル設定**（オプション）
   - サイドバーの「プロトコル設定」を展開
   - 既存のプロトコルを読み込むか、新規作成
   - 温度ステップ、ホールド時間、ランプ時間、解析時間を設定
   - 「プロトコルを保存」をクリックして保存

2. **データファイル選択**
   - サイドバーの「フォルダをブラウズ」にデータフォルダのパスを入力
   - ドロップダウンから解析したい.ascファイルを選択
   - または「Upload .asc file」から直接ファイルをアップロード

3. **解析パラメータ設定**
   - TX値（T20, T50, T80など）を選択
   - カスタムTX値も追加可能（カンマ区切り）

4. **グラフ設定**
   - フォントの種類とサイズを設定
   - デフォルト: Times New Roman、サイズ25

5. **解析実行**
   - 「解析実行」ボタンをクリック
   - 結果が自動的に表示されます

6. **結果の確認**
   - フィッティング結果（a, b, c, d, R²）
   - TX計算結果
   - 時系列データグラフ（使用データ範囲を色で表示）
   - 温度別データテーブル
   - 活性曲線グラフ

7. **グラフの保存**
   - 保存先フォルダを選択（プリセットまたはカスタムパス）
   - ファイル名を入力
   - DPI（解像度）を設定（デフォルト: 600）
   - 「グラフを保存」をクリック

## プロトコル設定について

### デフォルトプロトコル
- 8ステップ: 500, 450, 400, 350, 300, 250, 200, 150°C
- ホールド時間: 各20分
- ランプ時間: 10分
- 解析時間: 後半10分（ガス平衡化のため）

### カスタムプロトコルの作成
1. 「プロトコル設定」を展開
2. 「カスタムプロトコル」セクションで各パラメータを編集
3. プロトコル名を入力
4. 「プロトコルを保存」をクリック

### プロトコルの共有
`settings/` フォルダ内の `.json` ファイルを他のユーザーと共有することで、同じプロトコル設定を使用できます。

## ファイル構成

```
活性試験解析ソフト/
├── app.py                      # メインアプリケーション
├── 起動.bat                    # Windows用起動スクリプト
├── requirements.txt            # 必要なPythonパッケージ
├── README.md                   # このファイル
├── modules/                    # モジュールフォルダ
│   ├── data_processor.py      # データ処理
│   ├── fitting.py             # シグモイドフィッティング
│   ├── visualization.py       # グラフ生成
│   ├── language.py            # 多言語対応
│   └── settings_manager.py    # 設定管理
└── settings/                   # プロトコル設定ファイル（自動生成）
    └── default.json           # デフォルト設定
```

## 転換率計算式

```
転換率 [%] = -995.32 × 強度 + 101.36
```

## シグモイド関数

4パラメータシグモイド関数を使用：

```
y = d + (a - d) / (1 + exp(-b * (T - c)))
```

- a: 最大転換率
- b: 成長率（曲線の急峻さ）
- c: 変曲点温度
- d: 最小転換率

## トラブルシューティング

### アプリが起動しない
- Pythonが正しくインストールされているか確認
- 必要なパッケージがインストールされているか確認（`pip install -r requirements.txt`）
- コマンドプロンプトにエラーメッセージが表示されている場合は、その内容を確認

### フィッティングエラーが出る
- 活性が低すぎる（転換率がほぼ一定）場合、フィッティングは失敗しますが、時系列グラフと実測データグラフは表示されます
- データポイント数が少なすぎる場合は、ホールド時間や解析時間を調整してください

### グラフが文字化けする
- Times New Romanは日本語に対応していないため、日本語部分は別のフォントで表示されます
- 英語表示に切り替えることで、すべてTimes New Romanで表示できます

## ライセンス

このソフトウェアは研究・教育目的で自由に使用できます。

## 開発者向け情報

### コードの修正
各モジュールは独立しているため、機能ごとに修正が可能です：
- データ処理: `modules/data_processor.py`
- フィッティング: `modules/fitting.py`
- グラフ生成: `modules/visualization.py`
- 設定管理: `modules/settings_manager.py`
- 言語: `modules/language.py`

### 新しい言語の追加
`modules/language.py` の `TEXTS` 辞書に新しい言語キーを追加してください。

## 更新履歴

### Version 1.0
- 初回リリース
- 基本機能実装（データ読み込み、フィッティング、グラフ生成）
- カスタムプロトコル機能
- 設定の保存/読み込み機能
- 低活性サンプル対応

## お問い合わせ

問題や質問がある場合は、開発者に連絡してください。
